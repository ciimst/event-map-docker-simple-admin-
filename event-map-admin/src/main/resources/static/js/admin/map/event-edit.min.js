var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(a){var b=function(){};b.prototype=a;return new b};$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},b={};try{return b.__proto__=a,b.a}catch(c){}return!1};
$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null;
$jscomp.inherits=function(a,b){a.prototype=$jscomp.objectCreate(b.prototype);a.prototype.constructor=a;if($jscomp.setPrototypeOf){var c=$jscomp.setPrototypeOf;c(a,b)}else for(c in b)if("prototype"!=c)if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(b,c);d&&Object.defineProperty(a,c,d)}else a[c]=b[c];a.superClass_=b.prototype};
$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var f=a[e];if(b.call(c,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}};$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6","es3");$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};
$jscomp.assign="function"==typeof Object.assign?Object.assign:function(a,b){for(var c=1;c<arguments.length;c++){var d=arguments[c];if(d)for(var e in d)$jscomp.owns(d,e)&&(a[e]=d[e])}return a};$jscomp.polyfill("Object.assign",function(a){return a||$jscomp.assign},"es6","es3");var ADD_LINK=contextPath+"admin/map/event-basic/add",SAVE_LINK=contextPath+"admin/map/event-basic/save",MarkerMiniMap=function(a){return MiniMap.call(this,a)||this};$jscomp.inherits(MarkerMiniMap,MiniMap);
MarkerMiniMap.prototype.preInit=function(){this.layerItemDom=this.marker=void 0;this.coordinates={lat:eventItem.latitude,lng:eventItem.longitude};this.setEventTypeById(eventItem.eventTypeId);this.setEventGroupById(eventItem.eventGroupId)};
MarkerMiniMap.prototype.loadItems=function(){if(this.eventGroup&&this.eventType){var a=this.getCreateMarkerIconByEventType(this.eventType,this.eventGroup.color);this.removeLayer(this.marker);this.coordinates&&(this.marker=L.marker([this.coordinates.lat,this.coordinates.lng],{icon:a}).bindPopup(eventItem.description),this.addLayer(this.marker),this.setView(this.marker.getLatLng(),4))}};
MarkerMiniMap.prototype.onCreated=function(a){var b=a.layer;this.marker?custombox.alertError("Sadece 1 marker ekleyebilirsiniz"):(this.marker=b,this.reloadCoordinates(),MiniMap.prototype.onCreated.call(this,a))};MarkerMiniMap.prototype.onEdited=function(a){var b=this;a.layers.eachLayer(function(a){b.marker=a;b.reloadCoordinates()})};MarkerMiniMap.prototype.onDeleted=function(a){this.marker=void 0};
MarkerMiniMap.prototype.initUiTriggers=function(){var a=this;$("#longitude").on("change",function(){var b=$(this);clearTimeout(a.coordinateTimeout);a.coordinateTimeout=setTimeout(function(){a.coordinates.lng=b.val();a.loadItems()},300)});$("#latitude").on("change",function(){var b=$(this);clearTimeout(a.coordinateTimeout);a.coordinateTimeout=setTimeout(function(){a.coordinates.lat=b.val();a.loadItems()},300)});$("#eventTypeId").on("change",function(){a.setEventTypeById($(this).val());a.loadItems()});
$("#eventGroupId").on("change",function(){a.setEventGroupById($(this).val());a.loadItems()});this.addLayerItem()};MarkerMiniMap.prototype.getDrawOptions=function(){var a=MiniMap.prototype.getDrawOptions.call(this);a.draw.marker=!0;a.edit.remove=!0;return a};MarkerMiniMap.prototype.setEventTypeById=function(a){a=parseInt(a);this.eventType=eventTypes.find(function(b){return b.id===a})};
MarkerMiniMap.prototype.setEventGroupById=function(a){a=parseInt(a);this.eventGroup=eventGroups.find(function(b){return b.id===a})};MarkerMiniMap.prototype.reloadCoordinates=function(){var a=this.marker.getLatLng();this.coordinates.lat=a.lat;this.coordinates.lng=a.lng;$("#longitude").val(a.lng);$("#latitude").val(a.lat)};MarkerMiniMap.prototype.getCreateMarkerIconByEventType=function(a,b){a=this.getSvgFromEventType(a,b);return L.icon({iconUrl:a,iconSize:30})};
MarkerMiniMap.prototype.getSvgFromEventType=function(a,b){a=document.domFromString(a.image);a.setAttribute("fill",b);a.setAttribute("stroke","#6d6f71");a.setAttribute("stroke-width","1");b=document.domToString(a);return"data:image/svg+xml;base64,"+btoa("<svg xmlns='http://www.w3.org/2000/svg' version='1.1'  viewBox='0 0 100 100'> "+b+"</svg>")};MarkerMiniMap.prototype.updateLayerItem=function(){this.layerItemDom.innerHTML=this.getCurrentMapAreaGroup().layerName};
MarkerMiniMap.prototype.addLayerItem=function(){var a=this;L.Control.LayerItem=L.Control.extend({onAdd:function(b){b=L.DomUtil.create("div");Object.assign(b.style,{backgroundColor:"#fff",fontWeight:"bold",padding:"5px 10px 5px 10px"});b.innerHTML=a.eventGroup?a.eventGroup.layerName:"";a.layerItemDom=b;return a.layerItemDom},onRemove:function(a){}});L.control.layerItem=function(a){return new L.Control.LayerItem(a)};L.control.layerItem({position:"topright"}).addTo(this.getMap())};
var markerMiniMap=new MarkerMiniMap("mapid");
$(document).ready(function(){$("#m_aside_left_minimize_toggle").on("click",function(){setTimeout(function(){markerMiniMap.getMap().invalidateSize()},300)});eventNotFound&&custombox.alertError(lang.get("label.event.not.found"),function(){window.location.href=ADD_LINK});$("#save-button").on("click",function(){validate()&&($("form#event-form").serializeArray(),custombox.confirm("Kaydetmek istedi\u011finize emin misiniz?",function(a){a&&saveEvent()}))});$("form#event-form").find("#id").val()?$(".edit-page-title").html(lang.get("label.event.edit")):
$(".edit-page-title").html(lang.get("label.event.add"));$("input[name='eventDateStr']").datetimepicker({format:"dd.mm.yyyy HH:ii:ss",todayBtn:"linked",pickTime:!0,useSeconds:!1,showOn:"button",language:"tr",closeOnDateSelect:!0});$("div#m-dropzone-one").dropzone({url:contextPath+"admin/upload/single",paramName:"file",maxFiles:1,maxFilesize:5,headers:{"X-CSRF-TOKEN":csrf_token},success:function(a,b){console.log("e",a,"o",b)}})});
function validate(){return $("#latitude").val()?$("#longitude").val()?$("#eventGroupId").val()?$("#eventTypeId").val()?!0:(custombox.alertError(lang.get("label.eventType.not.found")),!1):(custombox.alertError(lang.get("label.eventGroup.not.found")),!1):(custombox.alertError("L\u00fctfen boylam alan\u0131n\u0131 bo\u015f b\u0131rakmay\u0131n\u0131z."),!1):(custombox.alertError("L\u00fctfen enlem alan\u0131n\u0131 bo\u015f b\u0131rakmay\u0131n\u0131z."),!1)}
function saveEvent(){var a=$("form#event-form").serializeArray();$.post(SAVE_LINK,a).fail(function(a){a.state=!1;console.error(a);a.description=lang.get("label.unknown.error");a.redirectUrl=null}).always(function(a){a.state?custombox.alertSuccess(a.description,function(){a.redirectUrl&&(window.location.href=contextPath+a.redirectUrl)}):custombox.alertError(a.description?a.description:lang.get("label.unknown.error"))})};
